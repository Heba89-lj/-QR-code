<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>بحث رقم الفحص</title>
    <style>
        body {
            font-family: "Cairo", sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 500px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #eef;
            border-radius: 8px;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        @media(max-width:600px) {
            .container {
                width: 90%;
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>بحث بيانات النيابة</h2>

        <label>رقم الفحص:</label>
        <input type="number" id="examNumber">

        <label>سنة الفحص:</label>
        <input type="text" id="year">

        <button id="searchBtn">بحث</button>

       

  <div id="result" style="margin-top:20px; font-weight:bold;"></div>
    </div>



 <!-- <script>
    const searchBtn = document.getElementById("searchBtn");

    searchBtn.addEventListener("click", async () => {
      const examNumber = document.getElementById("examNumber").value.trim();
      const year = document.getElementById("year").value.trim();
      const resultDiv = document.getElementById("result");
      const errorDiv = document.getElementById("error");

      resultDiv.style.display = "none";
      errorDiv.textContent = "";

      if (!examNumber || !year) {
        errorDiv.textContent = "ادخلي رقم الفحص وسنة الفحص";
        return;
      }

      try {
        const res = await fetch(`/search?examNumber=${examNumber}&year=${year}`);
        if (res.ok) {
          const data = await res.json();

          document.getElementById("resExamNumber").textContent = data.ExamNumber || data["رقم الفحص"] || "";
          document.getElementById("resYear").textContent = data.Year || data["السنة"] || "";
          document.getElementById("caseNumber").textContent = data.CaseNumber || data["رقم القضية"] || "";
          document.getElementById("applicantName").textContent = data.Applicant || data["اسم مقدم الطلب"] || "";
          document.getElementById("status").textContent = data.Status || data["حالة الفحص"] || data["حالة الطلب"] || "";
          document.getElementById("visa").textContent = data.Signatures || data["التأشيرات"] || "";
          document.getElementById("notes").textContent = data.Notes || data["ملاحظات"] || "";

          resultDiv.style.display = "block";
        } else if (res.status === 404) {
          errorDiv.textContent = "لا توجد بيانات";
        } else {
          errorDiv.textContent = "حدث خطأ، حاولى مرة اخرى";
        }
      } catch (err) {
        errorDiv.textContent = "حدث خطأ فى الاتصال بالسيرفر";
        console.error(err);
      }
    });
  </script> -->


   <script>
document.getElementById('searchBtn').addEventListener('click', async () => {
  const number = document.getElementById('number').value.trim();
  const year = document.getElementById('year').value.trim();
  const resultDiv = document.getElementById('result');

  resultDiv.innerHTML = ""; // مسح أي نتيجة سابقة

  if (!number || !year) {
    resultDiv.textContent = 'من فضلك أدخل رقم الفحص والسنة.';
    return;
  }

  resultDiv.textContent = 'جارٍ البحث...';

  try {
    // ✅ نرسل الطلب إلى دالة API على فيرسيل
    const res = await fetch(`/api/search?number=${encodeURIComponent(number)}&year=${encodeURIComponent(year)}`);

    if (!res.ok) {
      const text = await res.text();
      console.error("❌ خطأ من السيرفر:", text);
      resultDiv.textContent = `حدث خطأ في السيرفر (${res.status}): ${text}`;
      return;
    }

    // ✅ نحاول قراءة البيانات JSON
    const data = await res.json();

    if (data.success) {
      const r = data.result || {};

      // ✅ عرض النتائج في جدول منسق
      resultDiv.innerHTML = `
        <table style="margin:0 auto; text-align:right; border-collapse: collapse;">
          <tr><th style="padding:6px 12px;">رقم الفحص</th><td>${r.number || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">السنة</th><td>${r.year || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">رقم القضية</th><td>${r.caseNumber || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">اسم مقدم الطلب</th><td>${r.applicant || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">حالة الطلب</th><td>${r.status || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">التأشيرات</th><td>${r.visa || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">ملاحظات</th><td>${r.notes || "-"}</td></tr>
        </table>
      `;
    } else {
      resultDiv.textContent = data.message || 'لم يتم العثور على بيانات لهذا الفحص.';
    }
  } catch (err) {
    console.error("⚠️ خطأ في الاتصال:", err);
    resultDiv.textContent = 'حدث خطأ فى الاتصال بالسيرفر.';
  }
});
</script>

</body>

</html>

